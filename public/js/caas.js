$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var global={elements:{window:null,document:null,body:null,html:null},browsers:{msie:!1,opera:!1,chrome:!1,safari:!1,firefox:!1,versions:{ie8:!1,ie9:!1,ie10:!1,ie11:!1,edge:!1}},systems:{windows:!1,mac:!1,linux:!1,ios:!1,android:!1,handheld:!1},init:function(){global.elements.window=$(window),global.elements.document=$(document),global.elements.html=$("html"),global.elements.body=$("body");var appName=navigator.appName,userAgent=navigator.userAgent,browserMatch=userAgent.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),tem=null;browserMatch&&null!=(tem=userAgent.match(/version\/([\.\d]+)/i))&&(browserMatch[2]=tem[1]),browserMatch=browserMatch?[browserMatch[1],browserMatch[2]]:[appName,navigator.appVersion];var browser=browserMatch[0].toLowerCase(),version=browserMatch[1];userAgent.match(/Trident.*rv[ :]*11\./)?(browser="msie",version=11):userAgent.match(/\bEdge\/\d+/i)&&(browser="msie",version="edge"),global.elements.html.addClass(browser),global.browsers[browser]=!0,global.browsers.msie&&(isNaN(parseInt(version))||(version="ie"+parseInt(version)),global.elements.html.addClass(version),global.browsers.versions[version]=!0);var platform=navigator.platform,platformUppercase=platform.toUpperCase();platformUppercase.indexOf("WIN")>=0?global.systems.windows=!0:platformUppercase.indexOf("MAC")>=0?global.systems.mac=!0:platformUppercase.indexOf("LINUX")>=0?global.systems.linux=!0:platform.match(/(iPhone|iPod|iPad|Pike)/i)?global.systems.ios=!0:platform.match(/Android/i)&&(global.systems.android=!0);for(var key in global.systems)if(global.systems.hasOwnProperty(key)&&global.systems[key]){global.elements.html.addClass(key);break}global.systems.handheld=!!userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),global.elements.html.addClass(global.systems.handheld?"is-handheld":"not-handheld")}};$(global.init);var wait_for_final_event=function(){var timers={};return function(callback,ms,uniqueId){ms||(ms=50),uniqueId||(uniqueId="Don't call this twice without a uniqueId"),timers[uniqueId]&&clearTimeout(timers[uniqueId]),timers[uniqueId]=setTimeout(callback,ms)}}(),common={config:{faux_scrolled:0},init:function(){common.setup(),common.events()},setup:function(){common.actions.toggle_scrolled()},events:function(){global.elements.window.on("scroll",function(){wait_for_final_event(common.actions.toggle_scrolled,!1,"detect_scroll")})},actions:{toggle_scrolled:function(){var is_scrolled=common.config.faux_scrolled>0||global.elements.window.scrollTop()>0;global.elements.body.toggleClass("scrolled",is_scrolled)}}};$(common.init);var flyout={elements:{navs:null,overlay:null},config:{panels:{},open_queue:[],z_index:11,width:320,duration:250},scotchPanels:null,init:function(){flyout.setup(),flyout.events()},setup:function(){flyout.elements.navs=$("#primary-wrapper > .flyout-box"),flyout.elements.navs.each(flyout.actions.setup_flyout_box),flyout.elements.overlay=$(".overlay")},events:function(){flyout.elements.overlay.click(flyout.actions.close_panels),global.elements.document.on("click",".open-menu",flyout.actions.open_menu),global.elements.document.on("click",".close-menu",flyout.actions.close_menu),global.elements.document.keyup(flyout.actions.escape_key_close)},actions:{setup_flyout_box:function(){var el=$(this),id=el.attr("id");flyout.config.panels[id]=el.scotchPanel({forceMinHeight:!0,containerSelector:"#primary-wrapper",duration:flyout.config.duration,distanceX:flyout.config.width+"px",element:$("#"+id),beforePanelOpen:function(){flyout.elements.navs.css("z-index",0),this.element.css("z-index",++flyout.config.z_index),flyout.actions.load_menu_content($("#"+id));var x=0;"left"==this.direction?x=flyout.config.width+"px":"right"==this.direction&&(x="-"+flyout.config.width+"px"),$(".floating-header, .overlay").css("transform","translate3d("+x+", 0, 0)"),flyout.elements.overlay.addClass("-show")},beforePanelClose:function(){$(".floating-header, .overlay").css("transform","translate3d(0, 0, 0)"),flyout.elements.overlay.removeClass("-show")}})},escape_key_close:function(event){27==event.keyCode&&flyout.actions.close_panels()},close_panels:function(event){"undefined"!=typeof event&&event.preventDefault(),0!=flyout.config.open_queue.length&&(flyout.config.open_queue=[],$.each(flyout.config.panels,function(){this.close()}))},close_menu:function(event){event.preventDefault();var el=$(this),target_el=el.closest(".flyout-box"),id=target_el.attr("id"),scotchPanel=flyout.config.panels[id],index=flyout.config.open_queue.lastIndexOf(id);index>-1&&flyout.config.open_queue.splice(index,1);var still_open=flyout.config.open_queue.length||0;if(0==still_open)scotchPanel.close();else{var new_target=flyout.config.open_queue[still_open-1];flyout.actions.reopen_menu(target_el,new_target)}},open_menu:function(event){event.preventDefault();var el=$(this),target_el=$(el.data("target")),id=target_el.attr("id"),scotchPanel=flyout.config.panels[id];if("undefined"!=typeof scotchPanel){target_el.removeClass("invisible");var already_open=flyout.config.open_queue.length||0;0==already_open?scotchPanel.open():(flyout.actions.load_menu_content(target_el),flyout.actions.reopen_menu(target_el,id)),flyout.actions.scrolldown_menu(target_el),setTimeout(function(){flyout.elements.navs.not(target_el).addClass("invisible")},flyout.config.duration),flyout.config.open_queue.push(id)}},reopen_menu:function(target_el,new_target){var new_target_el=$("#"+new_target),new_target_scotchPanel=flyout.config.panels[new_target],scotchPanel=new_target_scotchPanel;if("undefined"!=typeof scotchPanel){new_target_el.removeClass("invisible");var direction=scotchPanel.settings.direction;target_el.css("z-index",++flyout.config.z_index),new_target_el.css("z-index",++flyout.config.z_index).css(direction,"-"+2*flyout.config.width+"px"),new_target_el.animate(function(o){return o[direction]="-"+flyout.config.width+"px",o}({}),flyout.config.duration),flyout.actions.scrolldown_menu(new_target_el)}},scrolldown_menu:function(el){var nav_content_height=el.find(".wrapper").height(),window_available_height=global.elements.window.height(),window_scrolled_amount=global.elements.window.scrollTop(),document_total_height=global.elements.document.height(),scroll_height_remaining=document_total_height-window_scrolled_amount,scroll_to=window_scrolled_amount;nav_content_height>scroll_height_remaining&&(scroll_to-=nav_content_height-scroll_height_remaining+20,$("html, body").animate({scrollTop:scroll_to+"px"},0)),el.css("top",scroll_to+"px").css("min-height",window_available_height+"px")},load_menu_content:function(el){var content_identifier=el.data("content");el.hasClass("-loading");if("undefined"!=typeof content_identifier){var loading_el=$("#flyout-loading-template").clone(!0,!0);loading_el.attr("id",""),loading_el.appendTo(el),$.ajax({url:"/flyouts/"+content_identifier}).done(function(data){el.html(data)}).fail(function(){el.html("<p>This panel was eaten by a Grue. Seek assistance!</p>")}).always(function(){el.removeClass("-loading")})}}}};$(flyout.init);